<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impermanent Loss Calculator - Useful Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <a href="../index.html" class="text-blue-400 hover:text-blue-300 mb-6 inline-block">‚Üê Retour</a>
        <h1 class="text-4xl font-bold mb-2">üíß Impermanent Loss Calculator</h1>
        <p class="text-gray-400 mb-8">Calculez la perte impermanente pour les pools de liquidit√© DeFi</p>

        <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 class="text-lg font-semibold mb-4">üìä Param√®tres</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Valeur initiale du d√©p√¥t ($)</label>
                        <input type="number" id="deposit" value="1000" min="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3" oninput="calculate()">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Variation du prix Token A (%)</label>
                        <input type="range" id="priceA" value="0" min="-90" max="500" class="w-full accent-blue-500" oninput="calculate()">
                        <div class="flex justify-between text-sm text-gray-400">
                            <span>-90%</span>
                            <span id="priceA-value" class="text-blue-400 font-bold">0%</span>
                            <span>+500%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Variation du prix Token B (%)</label>
                        <input type="range" id="priceB" value="0" min="-90" max="500" class="w-full accent-purple-500" oninput="calculate()">
                        <div class="flex justify-between text-sm text-gray-400">
                            <span>-90%</span>
                            <span id="priceB-value" class="text-purple-400 font-bold">0%</span>
                            <span>+500%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">APR du pool (%)</label>
                        <input type="number" id="apr" value="50" min="0" max="1000" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3" oninput="calculate()">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Dur√©e (jours)</label>
                        <input type="number" id="days" value="365" min="1" max="3650" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3" oninput="calculate()">
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div class="bg-red-900/30 rounded-xl p-6 border border-red-700/50">
                    <h3 class="text-lg font-semibold mb-2 text-red-400">üìâ Impermanent Loss</h3>
                    <div class="text-4xl font-bold text-red-400" id="il-percent">0%</div>
                    <div class="text-lg text-red-300" id="il-value">$0</div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
                        <div class="text-xl font-bold text-blue-400" id="hold-value">$0</div>
                        <div class="text-sm text-gray-400">Si HODL</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
                        <div class="text-xl font-bold text-purple-400" id="lp-value">$0</div>
                        <div class="text-sm text-gray-400">Si LP (sans rewards)</div>
                    </div>
                </div>
                <div class="bg-green-900/30 rounded-xl p-6 border border-green-700/50">
                    <h3 class="text-lg font-semibold mb-2 text-green-400">üéÅ Avec rewards</h3>
                    <div class="text-3xl font-bold text-green-400" id="with-rewards">$0</div>
                    <div class="text-sm text-green-300" id="net-result">Net: $0</div>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-slate-800 rounded-xl p-6 border border-slate-700">
            <h3 class="text-lg font-semibold mb-4">üìà Courbe d'Impermanent Loss</h3>
            <canvas id="chart" height="150"></canvas>
        </div>

        <div class="mt-6 bg-slate-800 rounded-xl p-6 border border-slate-700">
            <h3 class="text-lg font-semibold mb-4">‚ÑπÔ∏è Comment √ßa marche ?</h3>
            <p class="text-gray-400 text-sm">L'impermanent loss se produit quand le ratio de prix entre deux tokens dans un pool de liquidit√© change. Plus le changement est important, plus la perte est grande. La formule est :</p>
            <code class="block mt-2 bg-slate-700 p-3 rounded text-sm">IL = 2 √ó ‚àö(price_ratio) / (1 + price_ratio) - 1</code>
        </div>
    </div>

    <script>
        let chart;

        function calculateIL(priceRatio) {
            return 2 * Math.sqrt(priceRatio) / (1 + priceRatio) - 1;
        }

        function calculate() {
            const deposit = parseFloat(document.getElementById('deposit').value) || 1000;
            const priceChangeA = parseFloat(document.getElementById('priceA').value) / 100;
            const priceChangeB = parseFloat(document.getElementById('priceB').value) / 100;
            const apr = parseFloat(document.getElementById('apr').value) / 100;
            const days = parseFloat(document.getElementById('days').value) || 365;

            document.getElementById('priceA-value').textContent = (priceChangeA >= 0 ? '+' : '') + Math.round(priceChangeA * 100) + '%';
            document.getElementById('priceB-value').textContent = (priceChangeB >= 0 ? '+' : '') + Math.round(priceChangeB * 100) + '%';

            const newPriceA = 1 + priceChangeA;
            const newPriceB = 1 + priceChangeB;
            const priceRatio = newPriceA / newPriceB;

            const il = calculateIL(priceRatio);
            const holdValue = deposit * (0.5 * newPriceA + 0.5 * newPriceB);
            const lpValue = holdValue * (1 + il);
            const ilValue = lpValue - holdValue;
            const rewards = deposit * apr * (days / 365);
            const withRewards = lpValue + rewards;
            const netResult = withRewards - deposit;

            document.getElementById('il-percent').textContent = (il * 100).toFixed(2) + '%';
            document.getElementById('il-value').textContent = '$' + ilValue.toFixed(2);
            document.getElementById('hold-value').textContent = '$' + holdValue.toFixed(2);
            document.getElementById('lp-value').textContent = '$' + lpValue.toFixed(2);
            document.getElementById('with-rewards').textContent = '$' + withRewards.toFixed(2);
            document.getElementById('net-result').textContent = 'Net: ' + (netResult >= 0 ? '+' : '') + '$' + netResult.toFixed(2);

            // Chart
            const labels = [], ilData = [];
            for (let r = 0.1; r <= 10; r += 0.1) {
                labels.push(r.toFixed(1) + 'x');
                ilData.push(calculateIL(r) * 100);
            }

            if (chart) chart.destroy();
            chart = new Chart(document.getElementById('chart'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'IL %', data: ilData, borderColor: '#ef4444', backgroundColor: 'rgba(239,68,68,0.1)', fill: true }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { title: { display: true, text: 'Price Ratio', color: '#9ca3af' }, ticks: { color: '#9ca3af', maxTicksLimit: 10 } }, y: { title: { display: true, text: 'IL %', color: '#9ca3af' }, ticks: { color: '#9ca3af' } } } }
            });
        }

        calculate();
    </script>
</body>
</html>

